# IMPORTANT: This file contains TEMPLATES only.
# DO NOT commit actual secrets to Git!
# Use one of the following methods:
# 1. Sealed Secrets (Bitnami)
# 2. External Secrets Operator
# 3. HashiCorp Vault
# 4. AWS Secrets Manager / GCP Secret Manager

---
# External Secrets Operator - SecretStore Configuration
# Connects to AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secretsmanager
  namespace: cctv-system
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: cctv-api-sa

---
# External Secret for Database Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cctv-db-credentials-external
  namespace: cctv-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore
  target:
    name: cctv-db-credentials
    creationPolicy: Owner
  data:
  - secretKey: POSTGRES_USER
    remoteRef:
      key: cctv/production/database
      property: username
  - secretKey: POSTGRES_PASSWORD
    remoteRef:
      key: cctv/production/database
      property: password
  - secretKey: POSTGRES_DB
    remoteRef:
      key: cctv/production/database
      property: database
  - secretKey: DATABASE_URL
    remoteRef:
      key: cctv/production/database
      property: url

---
# External Secret for API Keys and Encryption
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cctv-api-keys-external
  namespace: cctv-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore
  target:
    name: cctv-api-keys
    creationPolicy: Owner
  data:
  - secretKey: ENCRYPTION_MASTER_KEY
    remoteRef:
      key: cctv/production/encryption
      property: master_key
  - secretKey: JWT_SECRET_KEY
    remoteRef:
      key: cctv/production/auth
      property: jwt_secret
  - secretKey: API_KEY_SALT
    remoteRef:
      key: cctv/production/auth
      property: api_key_salt

---
# External Secret for Redis Credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cctv-redis-credentials-external
  namespace: cctv-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore
  target:
    name: cctv-redis-credentials
    creationPolicy: Owner
  data:
  - secretKey: REDIS_PASSWORD
    remoteRef:
      key: cctv/production/redis
      property: password
  - secretKey: REDIS_URL
    remoteRef:
      key: cctv/production/redis
      property: url

---
# External Secret for TLS Certificates
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cctv-tls-cert-external
  namespace: cctv-system
spec:
  refreshInterval: 24h
  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore
  target:
    name: cctv-tls-cert
    creationPolicy: Owner
    template:
      type: kubernetes.io/tls
  data:
  - secretKey: tls.crt
    remoteRef:
      key: cctv/production/tls
      property: certificate
  - secretKey: tls.key
    remoteRef:
      key: cctv/production/tls
      property: private_key
  - secretKey: ca.crt
    remoteRef:
      key: cctv/production/tls
      property: ca_certificate

---
# HashiCorp Vault SecretStore (Alternative to AWS)
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: cctv-system
spec:
  provider:
    vault:
      server: "https://vault.company.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "cctv-system"
          serviceAccountRef:
            name: cctv-api-sa

---
# TEMPLATE: Manual Secret Creation (for local/dev)
# Run: kubectl create secret generic cctv-db-credentials \
#   --from-literal=POSTGRES_USER=<user> \
#   --from-literal=POSTGRES_PASSWORD=<password> \
#   --from-literal=POSTGRES_DB=cctv_db \
#   --from-literal=DATABASE_URL=postgresql://<user>:<pass>@postgres:5432/cctv_db \
#   --namespace=cctv-system

# TEMPLATE: TLS Secret Creation
# Run: kubectl create secret tls cctv-tls-cert \
#   --cert=path/to/tls.crt \
#   --key=path/to/tls.key \
#   --namespace=cctv-system

---
# Secret for Image Pull (if using private registry)
apiVersion: v1
kind: Secret
metadata:
  name: cctv-registry-credentials
  namespace: cctv-system
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: >-
    # REPLACE WITH: echo -n '{"auths":{"registry.company.com":{"username":"user","password":"pass","auth":"base64(user:pass)"}}}' | base64
    # For AWS ECR, use:
    # aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin <account>.dkr.ecr.us-east-1.amazonaws.com

---
# SealedSecret Template (for GitOps with Sealed Secrets)
# Generate with: kubeseal --format=yaml < secret.yaml > sealed-secret.yaml
# This is SAFE to commit to Git
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: cctv-sealed-db-creds
  namespace: cctv-system
spec:
  encryptedData:
    # Generated by kubeseal - EXAMPLE ONLY, NOT REAL
    POSTGRES_USER: AgBxxx...encrypted...xxx
    POSTGRES_PASSWORD: AgByyy...encrypted...yyy
    POSTGRES_DB: AgBzzz...encrypted...zzz
  template:
    metadata:
      name: cctv-db-credentials
      namespace: cctv-system
    type: Opaque

---
# Secret Rotation Policy (Custom CRD - requires operator)
apiVersion: secrets.cctv.io/v1
kind: SecretRotationPolicy
metadata:
  name: cctv-secret-rotation
  namespace: cctv-system
spec:
  secrets:
  - name: cctv-db-credentials
    rotationInterval: 30d
    strategy: rolling  # rolling, blue-green, or immediate
  - name: cctv-api-keys
    rotationInterval: 90d
    strategy: rolling
  - name: cctv-tls-cert
    rotationInterval: 365d
    strategy: blue-green
  notifications:
    - type: slack
      webhook: https://hooks.slack.com/services/XXX/YYY/ZZZ
    - type: email
      addresses:
        - security@company.com
