---
# IMPORTANT: DO NOT COMMIT ACTUAL SECRETS!
# This is a TEMPLATE ONLY - use for reference
# In production, use External Secrets Operator or sealed secrets

# Example: Create secrets manually with:
# kubectl create secret generic cctv-secrets \
#   --from-literal=database-url='postgresql://user:pass@postgres:5432/cctv_detection' \
#   --from-literal=redis-url='redis://:password@redis:6379/0' \
#   --from-literal=secret-key='your-secret-key-here' \
#   --from-literal=encryption-key='your-32-byte-hex-key' \
#   -n cctv-detection

---
# PostgreSQL Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
  namespace: cctv-detection
  labels:
    app: postgres
type: Opaque
stringData:
  username: "cctv_user"
  # password: "CHANGE_ME_IN_PRODUCTION"  # Use external secrets!
  # Generate with: openssl rand -base64 32

---
# Redis Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: redis-secret
  namespace: cctv-detection
  labels:
    app: redis
type: Opaque
stringData:
  # password: "CHANGE_ME_IN_PRODUCTION"  # Use external secrets!
  # Generate with: openssl rand -base64 32

---
# Application Secrets Template
apiVersion: v1
kind: Secret
metadata:
  name: cctv-secrets
  namespace: cctv-detection
  labels:
    app: cctv-api
type: Opaque
stringData:
  # database-url: "postgresql://user:pass@postgres:5432/cctv_detection"
  # redis-url: "redis://:password@redis:6379/0"
  # secret-key: "CHANGE_ME"  # openssl rand -hex 32
  # encryption-key: "CHANGE_ME"  # openssl rand -hex 32
  # jwt-secret: "CHANGE_ME"  # openssl rand -hex 32

---
# External Secrets Operator - AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: cctv-detection
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: external-secrets-sa

---
# External Secret for Database
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: postgres-external-secret
  namespace: cctv-detection
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: postgres-secret
    creationPolicy: Owner
  data:
    - secretKey: username
      remoteRef:
        key: cctv-detection/postgres
        property: username
    - secretKey: password
      remoteRef:
        key: cctv-detection/postgres
        property: password

---
# External Secret for Redis
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: redis-external-secret
  namespace: cctv-detection
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: redis-secret
    creationPolicy: Owner
  data:
    - secretKey: password
      remoteRef:
        key: cctv-detection/redis
        property: password

---
# External Secret for Application
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cctv-external-secret
  namespace: cctv-detection
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: cctv-secrets
    creationPolicy: Owner
  data:
    - secretKey: database-url
      remoteRef:
        key: cctv-detection/app
        property: database_url
    - secretKey: redis-url
      remoteRef:
        key: cctv-detection/app
        property: redis_url
    - secretKey: secret-key
      remoteRef:
        key: cctv-detection/app
        property: secret_key
    - secretKey: encryption-key
      remoteRef:
        key: cctv-detection/app
        property: encryption_key
    - secretKey: jwt-secret
      remoteRef:
        key: cctv-detection/app
        property: jwt_secret

---
# Vault SecretStore (Alternative to AWS)
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: cctv-detection
spec:
  provider:
    vault:
      server: "https://vault.example.com"
      path: "secret"
      version: "v2"
      auth:
        kubernetes:
          mountPath: "kubernetes"
          role: "cctv-detection"
          serviceAccountRef:
            name: external-secrets-sa
